<?php

require_once('shell.php');

class Schracklive_Shell_ProductStatusCustomized extends Schracklive_Shell {

	public function run() {
            $request = Mage::getModel('wws/request_getitemavail', array(
                'client'=>Mage::helper('wws')->createSoapClient(),
                'wwsCustomerId'=>(string)Mage::helper('wws')->getAnonymousWwsCustomerId(),
                'warehouseIds'=>$this->configStores(),
                'products'=> $this->fetchSkuList()));
            $request->call();
            $this->parseResponseToCSV($request->getAvailabilityInfos());
	}

	private function fetchSkuList() {
	    return array(
	        "IS503701--",
            "IS503703--",
            "IS503705--",
            "IS503716--",
            "IS503720--",
            "IS503725--",
            "IS503735--",
            "IS503750--",
            "IS503763--",
            "IS503820--",
            "IS503825--",
            "IS503835--",
            "IS503850--",
            "IS503863--",
            "IS503899--",
            "ISE71440--",
            "ISE71444--",
            "ISE71453--",
            "ISE71454--",
            "ISE71455--",
            "K-WOEH--E-",
            "MC195700--",
            "MC291400--",
            "MC391700--",
            "SI010040--",
            "SI010250--",
            "SI010260--",
            "SI010470--",
            "SI010680--",
            "SI010690--",
            "SI010710--",
            "SI010920--",
            "SI010940--",
            "SI010980--",
            "SI011000--",
            "SI011030--",
            "SI011040--",
            "SI011160--",
            "SI011190-A",
            "SI011310--",
            "SI011320--",
            "SI011350--",
            "SI011360--",
            "SI011380--",
            "SI011390--",
            "SI011410--",
            "SI011450--",
            "SI011470--",
            "SI011650--",
            "SI011660--",
            "SI011700--",
            "SI011820--",
            "SI011850--",
            "SI011860--",
            "SI011870--",
            "SI011900--",
            "SI011930--",
            "SI011960--",
            "SI011980--",
            "SI011990--",
            "SI012030--",
            "SI012040--",
            "SI012060--",
            "SI012070--",
            "SI012180--",
            "SI012230--",
            "SI012240--",
            "SI012270--",
            "SI012290--",
            "SI012300--",
            "SI012310--",
            "SI012320--",
            "SI012340--",
            "SI012360-A",
            "SI012370--",
            "SI012400--",
            "SI012430--",
            "SI012440--",
            "SI012450--",
            "SI012490--",
            "SI012500--",
            "SI012510--",
            "SI012520--",
            "SI012540--",
            "SI012720--",
            "SI012740--",
            "SI012840--",
            "SI012850--",
            "SI012870--",
            "SI012890--",
            "SI012900--",
            "SI012920--",
            "SI013010--",
            "SI013030--",
            "SI013140--",
            "SI013170--",
            "SI013180--",
            "SI013190--",
            "SI013200--",
            "SI013250--",
            "SI013560--",
            "SI013580--",
            "SI013600--",
            "SI013610--",
            "SI013630--",
            "SI013640--",
            "SI013670--",
            "SI013690--",
            "SI013700--",
            "SI013760--",
            "SI014130--",
            "SI014160--",
            "SI014170--",
            "SI014200--",
            "SI014210--",
            "SI014230--",
            "SI014240--",
            "SI014290--",
            "SI014300--",
            "SI014310--",
            "SI014320--",
            "SI014330--",
            "SI014340--",
            "SI014350--",
            "SI014360--",
            "SI014370--",
            "SI014380--",
            "SI014390--",
            "SI014400--",
            "SI014410--",
            "SI014420--",
            "SI014430--",
            "SI014440--",
            "SI014790--",
            "SI014800--",
            "SI014810--",
            "SI014820--",
            "SI014840--",
            "SI014850--",
            "SI014950--",
            "SI014980--",
            "SI015000--",
            "SI015080--",
            "SI015140--",
            "SI015150--",
            "SI015180--",
            "SI015370--",
            "SI015380--",
            "SI015390--",
            "SI015400-A",
            "SI015540--",
            "SI015550--",
            "SI015630--",
            "SI015700--",
            "SI015730--",
            "SI015860--",
            "SI015870--",
            "SI015900--",
            "SI015920--",
            "SI015930--",
            "SI015960--",
            "SI015970--",
            "SI016010--",
            "SI016020--",
            "SI016030--",
            "SI016080--",
            "SI016090--",
            "SI016160--",
            "SI016170--",
            "SI016180--",
            "SI016190--",
            "SI016200--",
            "SI016220--",
            "SI016240--",
            "SI016250--",
            "SI016260--",
            "SI016270--",
            "SI016280--",
            "SI016470--",
            "SI017420--",
            "SI017530--",
            "SI017540--",
            "SI017560--",
            "SI017570--",
            "SI017590--",
            "SI017600--",
            "SI017650--",
            "SI017660--",
            "SI017670--",
            "SI018230--",
            "SI018290--",
            "SI018860--",
            "SI019060--",
            "SI019070--",
            "SI019270--",
            "SI019320--",
            "SI019350--",
            "SI019360--",
            "SI019800--",
            "SI019810--",
            "SI019900-A",
            "SI019960--",
            "SI019970--",
            "SI031950--",
            "SI031990--",
            "SI032130--",
            "SI033500--",
            "SI033510--",
            "SI033550--",
            "SI033690--",
            "SI033700--",
            "SI035300--",
            "SI035320--",
            "SI035330--",
            "SI035340--",
            "SI036200--",
            "SI036540--",
            "SI036560--",
            "SI036570--",
            "SI036680--",
            "SI037270--",
            "SI037570--",
            "SI037580--",
            "SI037590--",
            "SI037600--",
            "SI037610--",
            "SI037620--",
            "SI037630--",
            "SI037670--",
            "SI037680--",
            "SI037690--",
            "SI037900--",
            "SI037910--",
            "SI037950--",
            "SI038490--",
            "SI039160--",
            "SI039170--",
            "SI039180--",
            "SI039190--",
            "SI039290--",
            "SI039300--",
            "SI051880--",
            "SI057790--",
            "SI057800--",
            "SI057820--",
            "SI057830--",
            "SI057840--",
            "SI057860--",
            "SI057870--",
            "SI057880--",
            "SI057900--",
            "SI057920--",
            "SI058000--",
            "SI058010--",
            "SI058020--",
            "SI088240--",
            "SI088250--",
            "SI112250--",
            "SI114050--",
            "SI303220--",
            "SI304730--",
            "SI310120--",
            "SI310270--",
            "SI310280--",
            "SI310390--",
            "SI310560--",
            "SI310700--",
            "SI310710--",
            "SI310840--",
            "SI311010--",
            "SI311020--",
            "SI311100--",
            "SI311110--",
            "SI311120--",
            "SI311130--",
            "SI311140--",
            "SI311150--",
            "SI311160--",
            "SI311170-A",
            "SI311180--",
            "SI311200--",
            "SI311230--",
            "SI311240--",
            "SI311300--",
            "SI311320--",
            "SI311330-A",
            "SI311570--",
            "SI311580--",
            "SI311730--",
            "SI311740--",
            "SI311750--",
            "SI311760--",
            "SI311860--",
            "SI312130--",
            "SI312480--",
            "SI312490--",
            "SI312750--",
            "SI312760--",
            "SI312770--",
            "SI312780--",
            "SI312790--",
            "SI312800--",
            "SI312810--",
            "SI312820--",
            "SI312830--",
            "SI312840--",
            "SI312860--",
            "SI312870--",
            "SI312910--",
            "SI312930--",
            "SI312950-A",
            "SI312960-A",
            "SI312970--",
            "SI313000--",
            "SI313010--",
            "SI313020--",
            "SI313030--",
            "SI313060--",
            "SI313080--",
            "SI313140--",
            "SI313150--",
            "SI313900--",
            "SI314410--",
            "SI314420--",
            "SI315250--",
            "SI315480--",
            "SI315490--",
            "SI315500--",
            "SI315520--",
            "SI315540--",
            "SI315740--",
            "SI315750--",
            "SI319010--",
            "SI319020--",
            "SI319030--",
            "SI319140--",
            "SI319190--",
            "SI319200--",
            "SI319210--",
            "SI319220--",
            "SI319250--",
            "SI319340--",
            "SI319350--",
            "SI319360--",
            "SI319460--",
            "SI319540--",
            "SI319580--",
            "SI319590--",
            "SI319680--",
            "SI319700--",
            "SI319710--",
            "SI319730--",
            "SI319740--",
            "SI320010--",
            "SI320040--",
            "SI320170--",
            "SI320230--",
            "SI320280--",
            "SI320310--",
            "SI320670--",
            "SI321460--",
            "SI321560--",
            "SI321570--",
            "SI321680--",
            "SI322140--",
            "SI322150--",
            "SI322160--",
            "SI323000--",
            "SI323010--",
            "SI323020--",
            "SI323070--",
            "SI323080--",
            "SI323090--",
            "SI323110--",
            "SI324000--",
            "SI324040--",
            "SI324120--",
            "SI324200--",
            "SI324270--",
            "SI324290-A",
            "SI324300--",
            "SI324310--",
            "SI324320--",
            "SI324330--",
            "SI324340--",
            "SI324360--",
            "SI324410--",
            "SI324420--",
            "SI324430--",
            "SI324440--",
            "SI324450--",
            "SI324460--",
            "SI324480--",
            "SI324490--",
            "SI324500--",
            "SI324520--",
            "SI324540--",
            "SI324550--",
            "SI324560--",
            "SI324570--",
            "SI324590--",
            "SI324630--",
            "SI324640--",
            "SI324660--",
            "SI324670--",
            "SI324690--",
            "SI324720--",
            "SI324770--",
            "SI324780--",
            "SI324860-A",
            "SI325750--",
            "SI325800--",
            "SI325810--",
            "SI325820--",
            "SI325930--",
            "SI326010--",
            "SI326300--",
            "SI326320--",
            "SI326330--",
            "SI326340--",
            "SI326370--",
            "SI326550--",
            "SI326600--",
            "SI326620--",
            "SI326660--",
            "SI326680--",
            "SI326690--",
            "SI326760--",
            "SI326820--",
            "SI326840--",
            "SI326860--",
            "SI326920--",
            "SI327010--",
            "SI327020--",
            "SI327040--",
            "SI327310--",
            "SI327330--",
            "SI327410--",
            "SI327420--",
            "SI327430--",
            "SI327450--",
            "SI327460--",
            "SI327470--",
            "SI327570--",
            "SI327580--",
            "SI327610--",
            "SI327620--",
            "SI327630--",
            "SI327750--",
            "SI327790--",
            "SI327800--",
            "SI327810--",
            "SI329470--",
            "SI329480--",
            "SI329490--",
            "SI329500--",
            "SI329510--",
            "SI329630--",
            "SI329730--",
            "SI329740--",
            "SI329750--",
            "SI329760--",
            "SI329770--",
            "SI329810--",
            "SI329830--",
            "SI329840--",
            "SI329850--",
            "SI329860--",
            "SI329870--",
            "SI330750--",
            "SI331420--",
            "SI331430--",
            "SI331440--",
            "SI331450--",
            "SI331460--",
            "SI331470--",
            "SI331480--",
            "SI331490--",
            "SI331500--",
            "SI331510--",
            "SI331530-A",
            "SI331560--",
            "SI331570--",
            "SI331600--",
            "SI331610--",
            "SI331620--",
            "SI331630--",
            "SI331650--",
            "SI331660--",
            "SI331670--",
            "SI331680--",
            "SI331980--",
            "SI331990--",
            "SI332000--",
            "SI332010-A",
            "SI332020--",
            "SI332030--",
            "SI332040--",
            "SI332060--",
            "SI332070--",
            "SI332080--",
            "SI332160--",
            "SI332170--",
            "SI332190--",
            "SI332210--",
            "SI332240--",
            "SI332340--",
            "SI332350--",
            "SI332380--",
            "SI332460--",
            "SI332470--",
            "SI332680--",
            "SI332850--",
            "SI333080--",
            "SI333110--",
            "SI333150--",
            "SI333160--",
            "SI333170--",
            "SI333240--",
            "SI333250--",
            "SI333260--",
            "SI333270--",
            "SI333280--",
            "SI333290--",
            "SI333310--",
            "SI333320--",
            "SI333370-A",
            "SI333420--",
            "SI333450--",
            "SI333470--",
            "SI333480--",
            "SI333510--",
            "SI333550-A",
            "SI333560--",
            "SI333650--",
            "SI333660-A",
            "SI333760--",
            "SI333770--",
            "SI333780--",
            "SI333800--",
            "SI333920--",
            "SI333930--",
            "SI333980--",
            "SI334020--",
            "SI334030--",
            "SI334080--",
            "SI334090--",
            "SI334160--",
            "SI334180--",
            "SI334210--",
            "SI334220--",
            "SI334710--",
            "SI335000--",
            "SI335020--",
            "SI335030--",
            "SI335050--",
            "SI335060--",
            "SI335100--",
            "SI335160--",
            "SI335430--",
            "SI336000--",
            "SI336010-A",
            "SI336020--",
            "SI336030--",
            "SI336100--",
            "SI336110--",
            "SI336120--",
            "SI336130--",
            "SI336140--",
            "SI336150--",
            "SI336160--",
            "SI336170--",
            "SI336200--",
            "SI336210--",
            "SI336220--",
            "SI336230--",
            "SI336240--",
            "SI336250--",
            "SI336260--",
            "SI336270--",
            "SI336300--",
            "SI336310--",
            "SI336320--",
            "SI336330--",
            "SI336340--",
            "SI336350--",
            "SI336360--",
            "SI336380--",
            "SI336400--",
            "SI336420--",
            "SI336450--",
            "SI336460--",
            "SI336470--",
            "SI336480--",
            "SI336490--",
            "SI336500--",
            "SI336510--",
            "SI336520--",
            "SI337000--",
            "SI337010--",
            "SI337020--",
            "SI337030--",
            "SI337040--",
            "SI337170--",
            "SI337200--",
            "SI337210--",
            "SI337220--",
            "SI337230--",
            "SI337250--",
            "SI337260--",
            "SI337270--",
            "SI337280--",
            "SI337310--",
            "SI337320--",
            "SI337330--",
            "SI337340--",
            "SI337350--",
            "SI337360--",
            "SI337380--",
            "SI337390--",
            "SI337400--",
            "SI337410--",
            "SI337420--",
            "SI337490--",
            "SI337500--",
            "SI337510--",
            "SI337520--",
            "SI337580--",
            "SI337620--",
            "SI337650--",
            "SI337700--",
            "SI337720--",
            "SI337730--",
            "SI337740--",
            "SI338000--",
            "SI338020--",
            "SI339060--",
            "SI339080--",
            "SI339100--",
            "SI339110--",
            "SI339120--",
            "SI339130--",
            "SI339170--",
            "SI339180--",
            "SI339370--",
            "SI350010--",
            "SI350040--",
            "SI350050-A",
            "SI350060--",
            "SI350070--",
            "SI350080--",
            "SI350090--",
            "SI350160--",
            "SI360030--",
            "SI360090--",
            "SI361000--",
            "SI361010--",
            "SI361020--",
            "SI361030--",
            "SI361040--",
            "SI361050--",
            "SI361060--",
            "SI361070--",
            "SI361080--",
            "SI361090--",
            "SI361100--",
            "SI361110--",
            "SI361120--",
            "SI361130--",
            "SI361530--",
            "SI361540--",
            "SI362000--",
            "SI372120--",
            "SI372130--",
            "SI372140--",
            "SI372160--",
            "SI372210--",
            "SI379000--",
            "SI784420--",
            "SI784430--",
            "SI784470--",
            "SI784630--",
            "SI794480--",
            "SI794490--",
            "SI796630--",
            "SI798110--",
            );
	}

	private function configStores() {
	    $allStoresAT = array(10, 20, 30, 40, 50, 60, 70, 80);
	    return $allStoresAT;
	}

    private function headlineCSV_AT() {
        $stores = $this->configStores();
        $allStores = array(
            10 => '"Linz (10)"',
            20 => '"Graz (20)"',
            30 => '"Innsbruck (30)"',
            40 => '"Salzburg (40)"',
            50 => '"Dornbirn (50)"',
            60 => '"Klagenfurt (60)"',
            70 => '"Wien (70)"',
            80 => '"Zustellung (80)"',
        );

        $headline = '"SKU (Artikelnummer)";';

        foreach($stores as $index => $store) {
            $headline .= $allStores[$store] . ';';
        }
        $headline .= "\n";
        return $headline;
    }

	private function parseResponseToCSV($response) {
        $row = $this->headlineCSV_AT();

	    foreach($response as $sku => $storeBlocks) {
            $row .= '"' . $sku . '";';
            $temp = array();
	        foreach($storeBlocks as $store => $attribute) {
                $temp[$store] = $attribute['qty'];
	        }
            ksort($temp);
	        foreach ($temp as $index => $qty) {
                $row .= '"' . $qty . '";';
	        }
            $row .= "\n";
	    }
	    $filename = 'artikel_lagerstand_at_' . date('Y_m_d_H_i') . '.csv';

        Mage::helper('schrack/email')->sendDeveloperMail('LagestÃ¤nde AT (Artikelliste)','Nur der Anhang ist wichtig',$row,$filename);
	}
}

$shell = new Schracklive_Shell_ProductStatusCustomized();
$shell->run();

