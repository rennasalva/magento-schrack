var counter=0,count=1;function timer(){if(--count<=0)return clearInterval(counter),void jQuery("#progressBlocker").val(0)}function checkoutActionOne(){localStorage.newCheckoutActionPath="",jQuery("#checkout_saveShippingMethodButtonContinueAlternate").hide(),localStorage.newCheckoutProcessLastUpdateTime=Math.floor(Date.now()/1e3),jQuery("#shipping-method-buttons-container-alternate").css("opacity",.5),jQuery("#shipping-method-please-wait-alternate").show(),localStorage.newCheckoutProcessCurrentStep="opc-payment",localStorage.newCheckoutShippingMethod="pickup",localStorage.newCheckoutPickupLocation=localStorage.newCheckoutSelectedPickupLocation,shipping.save(),shippingMethod.save()}function checkoutActionTwo(){localStorage.newCheckoutActionPath="",jQuery("#checkout_saveShippingMethodButtonContinueAlternate").hide(),localStorage.newCheckoutProcessLastUpdateTime=Math.floor(Date.now()/1e3),jQuery("#shipping-method-buttons-container-alternate").css("opacity",.5),jQuery("#shipping-method-please-wait-alternate").show(),localStorage.newCheckoutProcessCurrentStep="opc-payment",localStorage.newCheckoutShippingMethod="pickup",localStorage.newCheckoutPickupLocation=localStorage.newCheckoutSelectedPickupLocation,shipping.save(),shippingMethod.save()}function checkoutActionThree(){localStorage.newCheckoutActionPath="",shippingMethod.save()}function checkoutActionFour(){localStorage.newCheckoutActionPath="",jQuery("#checkout_saveShippingMethodButtonContinueAlternate").hide(),localStorage.newCheckoutProcessLastUpdateTime=Math.floor(Date.now()/1e3),jQuery("#shipping-method-buttons-container-alternate").css("opacity",.5),jQuery("#shipping-method-please-wait-alternate").show(),localStorage.newCheckoutProcessCurrentStep="opc-payment",localStorage.newCheckoutShippingMethod="pickup",localStorage.newCheckoutPickupLocation=localStorage.newCheckoutSelectedPickupLocation,"guest"==localStorage.newCheckoutProcessCurrentRole&&1==localStorage.newCheckoutMagicFlag1?console.log("opcheckout.js -> CHECKPOINT available.phtml #002"):(console.log("opcheckout.js -> CHECKPOINT available.phtml #003"),shipping.save()),shippingMethod.save()}function getProductAvailabilityInStore(e,t,o,a){console.log("opcheckout.js -> chosed action = "+a),localStorage.newCheckoutActionPath=a,jQuery.ajax(e,{dataType:"json",type:"POST",data:{form_key:o,pickup_store:t},success:function(e){if(null!=e&&0<e.length){console.log("opcheckout.js -> we found products which are not available, manageable or not enough amount in selected store");var t='<table class="checkout_modal_result_not_available_product_list_table">',o='<table class="checkout_modal_result_not_available_product_list_table">',s="",r=!1,c=!1;s='<tr><td class="checkoutSkuNotAvailableHeader">',s+=Translator.translate("Product"),s+='</td><td class="checkoutCartQtySelectedHeader">',s+=Translator.translate("In Cart"),s+='</td><td class="checkoutStoreQtyAvailableHeader">',s+=Translator.translate("Pickupable"),o=t+=s+="</td></tr>";for(var i=0;i<e.length;i++)1!=e[i].OnlyAmountMarker&&2!=e[i].OnlyAmountMarker||(s='<tr><td class="checkoutSkuNotAvailable">',s+=e[i].sku+'</td><td class="checkoutCartQtySelected">',s+=e[i].selectedAmountInCart,s+='</td><td class="checkoutStoreQtyAvailable">',s+=e[i].availableAmountInSelectedStock,t+=s+="</td></tr>",r=!0),2!=e[i].OnlyAmountMarker&&3!=e[i].OnlyAmountMarker||(s='<tr><td class="checkoutSkuNotAvailable">',s+=e[i].sku+'</td><td class="checkoutCartQtySelected">',s+=e[i].selectedAmountInCart,s+='</td><td class="checkoutStoreQtyAvailable">',s+=e[i].availableAmountInSelectedStock,o+=s+="</td></tr>",c=!0);1==r&&(t+="</table>",jQuery("#checkout_modal_result_not_available_product_list").html(t),jQuery("#checkout_modal_result_not_available_product_list_container").show()),1==c&&(o+="</table>",jQuery(".checkout_modal_right_button").hide(),jQuery("#checkout_modal_result_not_manageable_product_list").html(o),jQuery("#checkout_modal_result_not_manageable_product_list_container").show()),jQuery("#checkout_modal_pickup_warning").modal()}else console.log("opcheckout.js -> all products avasilable in selected store and amount"),"action_one"==a&&checkoutActionOne(),"action_two"==a&&checkoutActionTwo(),"action_three"==a&&checkoutActionThree(),"action_four"==a&&checkoutActionFour()},error:function(e){}})}var Checkout=Class.create();Checkout.prototype={initialize:function(e,t){this.accordion=e,this.progressUrl=t.progress,this.reviewUrl=t.review,this.saveMethodUrl=t.saveMethod,this.failureUrl=t.failure,this.billingForm=!1,this.shippingForm=!1,this.syncBillingShipping=!1,this.method="",this.payment="",this.loadWaiting=!1,this.steps=["login","shipping_method","billing","shipping","payment","review"],this.accordion.disallowAccessToNextSections=!0},ajaxFailure:function(){location.href=this.failureUrl},reloadProgressBlock:function(){new Ajax.Updater("checkout-progress-wrapper",this.progressUrl,{evalScripts:!0,method:"get",onFailure:this.ajaxFailure.bind(this)})},reloadReviewBlock:function(){new Ajax.Updater("checkout-review-load",this.reviewUrl,{method:"get",onFailure:this.ajaxFailure.bind(this)})},_disableEnableAll:function(e,t){var o=e.descendants();for(var s in o)o[s].disabled=t;e.disabled=t},setLoadWaiting:function(e,t){if(e)this.loadWaiting&&this.setLoadWaiting(!1),(o=$(e+"-buttons-container")).addClassName("disabled"),o.setStyle({opacity:.5}),this._disableEnableAll(o,!0),Element.show(e+"-please-wait");else if(this.loadWaiting){var o=$(this.loadWaiting+"-buttons-container"),s=!!t;s||(o.removeClassName("disabled"),o.setStyle({opacity:1})),this._disableEnableAll(o,s),Element.hide(this.loadWaiting+"-please-wait")}this.loadWaiting=e},gotoSection:function(e){try{var t=window.location.pathname,o=t.substring(0,t.lastIndexOf("/"));if("undefined"!=typeof ga&&ga)switch(gaLocation=o+"/"+e+"/",e){case"shipping_method":localStorage.newCheckoutProcessCurrentStep="opc-shipping_method",console.log("opcheckout.js -> Current Active Step = SHIPPING METHOD");break;case"billing":localStorage.newCheckoutProcessCurrentStep="opc-billing",console.log("opcheckout.js -> Current Active Step = BILLING"),jQuery("#step_one_progress_circle").html("&#10122;"),jQuery("#step_one_progress_circle").addClass("checkout_progress_color_active"),jQuery("#step_one_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_two_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_two_progress_circle").html("&#10123;"),jQuery("#step_three_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_three_progress_circle").html("&#10124;"),jQuery("#step_four_progress_circle").html("&#10125;"),jQuery("#step_one_two_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_two_three_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_three_four_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_two_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#step_three_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#step_four_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#checkout_tab_header_shipping_method").removeClass("checkout_step_active_tab "),jQuery("#checkout_tab_header_shipping_method").addClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_inactive_untouched_tab "),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_shipping").addClass("checkout_step_active_tab ");break;case"shipping":"pickup"==localStorage.newCheckoutShippingMethod&&("full-register-prospect-application"!=localStorage.newCheckoutProcessSpecialAction&&"guest"!=localStorage.newCheckoutProcessCurrentRole||"guest"==localStorage.newCheckoutProcessCurrentRole&&1==localStorage.newCheckoutMagicFlag1)&&(e="payment",localStorage.newCheckoutProcessCurrentStep="opc-payment",console.log("opcheckout.js -> Current Active Step = PAYMENT METHOD (in SHIPPING CASE)"),jQuery("#step_one_progress_circle").html("&#10112;"),jQuery("#step_one_progress_circle").addClass("checkout_progress_link"),jQuery("#step_one_progress_circle").addClass("checkout_progress_color_active"),jQuery("#step_one_two_progress_circle_line").addClass("checkout_progress_hr_line_active"),jQuery("#step_two_progress_circle").html("&#10113;"),jQuery("#step_two_progress_circle").addClass("checkout_progress_link"),jQuery("#step_two_progress_circle").addClass("checkout_progress_color_active"),jQuery("#step_two_three_progress_circle_line").addClass("checkout_progress_hr_line_active"),jQuery("#step_three_progress_circle").addClass("checkout_progress_color_active"),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_inactive_untouched_tab "),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_active_tab "),jQuery("#checkout_tab_header_shipping").addClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_payment").removeClass("checkout_step_inactive_untouched_tab  "),jQuery("#checkout_tab_header_payment").removeClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_payment").addClass("checkout_step_active_tab "),jQuery("#checkout_select_store_pickup_container").hide()),"pickup"==localStorage.newCheckoutShippingMethod&&"full-register-prospect-application"==localStorage.newCheckoutProcessSpecialAction&&(localStorage.newCheckoutProcessCurrentStep="opc-shipping","prospect-light"==localStorage.newCheckoutProspectRole?(localStorage.newCheckoutProcessCurrentStep="opc-shipping",console.log("opcheckout.js -> Current Active Step = SHIPPING (Light Prospect)"),console.log("Status : light prospect needs to be complete all company address data and other company related data (pickup route 2)"),jQuery("#new_address_button").click(),jQuery("#step_one_progress_circle").html("&#10122;"),jQuery("#step_one_progress_circle").addClass("checkout_progress_color_active"),jQuery("#step_one_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_two_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_two_progress_circle").html("&#10123;"),jQuery("#step_three_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_three_progress_circle").html("&#10124;"),jQuery("#step_four_progress_circle").html("&#10125;"),jQuery("#step_one_two_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_two_three_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_three_four_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_two_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#step_three_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#step_four_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#checkout_tab_header_shipping_method").removeClass("checkout_step_active_tab "),jQuery("#checkout_tab_header_shipping_method").addClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_inactive_untouched_tab "),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_shipping").addClass("checkout_step_active_tab ")):(console.log("opcheckout.js -> Current Active Step = BILLING (in SHIPPING CASE)"),jQuery("#step_one_progress_circle").html("&#10122;"),jQuery("#step_one_progress_circle").addClass("checkout_progress_color_active"),jQuery("#step_one_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_two_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_two_progress_circle").html("&#10123;"),jQuery("#step_three_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_three_progress_circle").html("&#10124;"),jQuery("#step_four_progress_circle").html("&#10125;"),jQuery("#step_one_two_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_two_three_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_three_four_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_two_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#step_three_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#step_four_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#checkout_tab_header_shipping_method").removeClass("checkout_step_active_tab "),jQuery("#checkout_tab_header_shipping_method").addClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_inactive_untouched_tab "),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_shipping").addClass("checkout_step_active_tab "),"processCheckoutAsNonLoggedInUser"!=localStorage.newCheckoutRunningProcess&&jQuery("#shipping-form-container").show())),"delivery"==localStorage.newCheckoutShippingMethod&&(localStorage.newCheckoutProcessCurrentStep="opc-shipping",console.log("opcheckout.js -> Current Active Step = SHIPPING"),"0"==localStorage.customerNotLoggedIn&&"prospect-user"==localStorage.newCheckoutProcessCurrentRole&&"prospect-light"==localStorage.newCheckoutProspectRole&&"full-register-prospect-application"==localStorage.newCheckoutProcessSpecialAction&&"opc-shipping"==localStorage.newCheckoutProcessCurrentStep&&(console.log("Status : light prospect needs to be complete all company address data and other company related data (delivery route)"),jQuery("#new_address_button").click()),jQuery("#step_one_progress_circle").html("&#10122;"),jQuery("#step_one_progress_circle").addClass("checkout_progress_color_active"),jQuery("#step_one_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_two_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_two_progress_circle").html("&#10123;"),jQuery("#step_three_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_three_progress_circle").html("&#10124;"),jQuery("#step_four_progress_circle").html("&#10125;"),jQuery("#step_one_two_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_two_three_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_three_four_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_two_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#step_three_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#step_four_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#checkout_tab_header_shipping_method").removeClass("checkout_step_active_tab "),jQuery("#checkout_tab_header_shipping_method").addClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_inactive_untouched_tab "),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_shipping").addClass("checkout_step_active_tab "),"processCheckoutAsNonLoggedInUser"!=localStorage.newCheckoutRunningProcess&&jQuery("#shipping-form-container").show()),"container"==localStorage.newCheckoutShippingMethod&&(localStorage.newCheckoutProcessCurrentStep="opc-shipping",console.log("opcheckout.js -> Current Active Step = SHIPPING"),jQuery("#step_one_progress_circle").html("&#10122;"),jQuery("#step_one_progress_circle").addClass("checkout_progress_color_active"),jQuery("#step_one_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_two_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_two_progress_circle").html("&#10123;"),jQuery("#step_three_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_three_progress_circle").html("&#10124;"),jQuery("#step_four_progress_circle").html("&#10125;"),jQuery("#step_one_two_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_two_three_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_three_four_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_two_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#step_three_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#step_four_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#checkout_tab_header_shipping_method").removeClass("checkout_step_active_tab "),jQuery("#checkout_tab_header_shipping_method").addClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_inactive_untouched_tab "),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_shipping").addClass("checkout_step_active_tab "),"processCheckoutAsNonLoggedInUser"!=localStorage.newCheckoutRunningProcess&&jQuery("#shipping-form-container").show()),"inpost"==localStorage.newCheckoutShippingMethod&&(localStorage.newCheckoutProcessCurrentStep="opc-shipping",console.log("opcheckout.js -> Current Active Step = SHIPPING"),jQuery("#step_one_progress_circle").html("&#10122;"),jQuery("#step_one_progress_circle").addClass("checkout_progress_color_active"),jQuery("#step_one_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_two_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_two_progress_circle").html("&#10123;"),jQuery("#step_three_progress_circle").removeClass("checkout_progress_link"),jQuery("#step_three_progress_circle").html("&#10124;"),jQuery("#step_four_progress_circle").html("&#10125;"),jQuery("#step_one_two_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_two_three_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_three_four_progress_circle_line").removeClass("checkout_progress_hr_line_active"),jQuery("#step_two_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#step_three_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#step_four_progress_circle").removeClass("checkout_progress_color_active"),jQuery("#checkout_tab_header_shipping_method").removeClass("checkout_step_active_tab "),jQuery("#checkout_tab_header_shipping_method").addClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_inactive_untouched_tab "),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_shipping").addClass("checkout_step_active_tab "),"processCheckoutAsNonLoggedInUser"!=localStorage.newCheckoutRunningProcess&&jQuery("#shipping-form-container").show());break;case"payment":console.log("opcheckout.js -> Current Active Step = PAYMENT METHOD"),"prospect-light"==localStorage.newCheckoutProspectRole&&"opc-shipping_method"==localStorage.newCheckoutProcessCurrentStep?(console.log("Alternative route to pickup selection (light prospect)"),jQuery("#checkout_saveShippingMethodButtonAlternate").removeClass("checkout_saveShippingMethodButtonAlternate"),jQuery("#checkout_saveShippingMethodButtonAlternate").addClass("checkout_saveShippingMethodButtonAlternatePickup"),localStorage.newCheckoutMagicFlag1=1,jQuery("#checkout-step-billing").hide(),jQuery("#co-billing-form").hide(),jQuery("#co-shipping-form").hide(),jQuery("#checkout_select_store_pickup_container").appendTo("#shipping-form-container"),jQuery("#co-shipping-method-form").hide(),jQuery("#checkout-step-shipping").show(),jQuery("#shipping-form-container").show(),jQuery("#checkout_select_store_pickup").removeClass("hidden"),jQuery("#checkout_select_store_pickup_container").show(),localStorage.newCheckoutProcessCurrentStep="opc-shipping",localStorage.newCheckoutShippingMethod="pickup",localStorage.newCheckoutPickupLocation=localStorage.newCheckoutSelectedPickupLocation):(localStorage.newCheckoutProcessCurrentStep="opc-payment",jQuery("#step_one_progress_circle").html("&#10112;"),jQuery("#step_one_progress_circle").addClass("checkout_progress_link"),jQuery("#step_one_progress_circle").addClass("checkout_progress_color_active"),jQuery("#step_one_two_progress_circle_line").addClass("checkout_progress_hr_line_active"),jQuery("#step_two_progress_circle").html("&#10113;"),jQuery("#step_two_progress_circle").addClass("checkout_progress_link"),jQuery("#step_two_progress_circle").addClass("checkout_progress_color_active"),jQuery("#step_two_three_progress_circle_line").addClass("checkout_progress_hr_line_active"),jQuery("#step_three_progress_circle").addClass("checkout_progress_color_active"),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_inactive_untouched_tab "),jQuery("#checkout_tab_header_shipping").removeClass("checkout_step_active_tab "),jQuery("#checkout_tab_header_shipping").addClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_payment").removeClass("checkout_step_inactive_untouched_tab  "),jQuery("#checkout_tab_header_payment").removeClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_payment").addClass("checkout_step_active_tab "),jQuery("#checkout_select_store_pickup_container").hide(),jQuery("#shipping-method-please-wait-alternate").hide(),jQuery("#shipping-method-buttons-container-alternate").css("opacity",1));break;case"review":localStorage.newCheckoutProcessCurrentStep="opc-review",console.log("opcheckout.js -> Current Active Step = REVIEW"),jQuery("#step_one_progress_circle").html("&#10112;"),jQuery("#step_one_progress_circle").addClass("checkout_progress_link"),jQuery("#step_one_progress_circle").addClass("checkout_progress_color_active"),jQuery("#step_one_two_progress_circle_line").addClass("checkout_progress_hr_line_active"),jQuery("#step_two_progress_circle").html("&#10113;"),jQuery("#step_two_progress_circle").addClass("checkout_progress_link"),jQuery("#step_two_progress_circle").addClass("checkout_progress_color_active"),jQuery("#step_two_three_progress_circle_line").addClass("checkout_progress_hr_line_active"),jQuery("#step_three_progress_circle").html("&#10114;"),jQuery("#step_three_progress_circle").addClass("checkout_progress_link"),jQuery("#step_three_progress_circle").addClass("checkout_progress_color_active"),jQuery("#step_three_four_progress_circle_line").addClass("checkout_progress_hr_line_active"),jQuery("#step_four_progress_circle").addClass("checkout_progress_color_active"),jQuery("#checkout_tab_header_payment").removeClass("checkout_step_inactive_untouched_tab "),jQuery("#checkout_tab_header_payment").removeClass("checkout_step_active_tab "),jQuery("#checkout_tab_header_payment").addClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_review").removeClass("checkout_step_inactive_untouched_tab  "),jQuery("#checkout_tab_header_review").removeClass("checkout_step_inactive_tab "),jQuery("#checkout_tab_header_review").addClass("checkout_step_active_tab ")}}catch(e){}(e=$("opc-"+e)).addClassName("allow"),this.accordion.openSection(e)},setMethod:function(){if($("login:guest")&&$("login:guest").checked){this.method="guest";new Ajax.Request(this.saveMethodUrl,{method:"post",onFailure:this.ajaxFailure.bind(this),parameters:{method:"guest"}});Element.hide("register-customer-password"),this.gotoSection("billing")}else{if(!$("login:register")||!$("login:register").checked&&"hidden"!=$("login:register").type)return alert(Translator.translate("Please choose to register or to checkout as a guest")),!1;this.method="register";new Ajax.Request(this.saveMethodUrl,{method:"post",onFailure:this.ajaxFailure.bind(this),parameters:{method:"register"}});Element.show("register-customer-password"),this.gotoSection("billing")}},setBilling:function(){$("billing:use_for_shipping_yes")&&$("billing:use_for_shipping_yes").checked?(shipping.syncWithBilling(),$("opc-shipping").addClassName("allow"),this.gotoSection("payment")):($("billing:use_for_shipping_no")&&$("billing:use_for_shipping_no").checked?$("shipping:same_as_billing").checked=!1:$("shipping:same_as_billing").checked=!0,this.gotoSection("shipping")),this.reloadProgressBlock()},setShipping:function(){this.reloadProgressBlock(),this.gotoSection("payment")},setShippingMethod:function(){this.reloadProgressBlock(),this.gotoSection("payment")},setPayment:function(){this.reloadProgressBlock(),this.gotoSection("review")},setReview:function(){this.reloadProgressBlock()},back:function(){this.loadWaiting||this.accordion.openPrevSection(!0)},setStepResponse:function(e){return e.update_section&&$("checkout-"+e.update_section.name+"-load").update(e.update_section.html),e.allow_sections&&e.allow_sections.each(function(e){$("opc-"+e).addClassName("allow")}),e.goto_section?(this.reloadProgressBlock(),"shipping_method"==e.goto_section&&"processCheckoutAsNonLoggedInUser"==localStorage.newCheckoutRunningProcess?jQuery("#checkout_saveBillingButton").hasClass("checkout_saveBillingButtonAlternate")?(console.log("Special Case #1 (new Customer Application or guest)"),jQuery("#checkout_saveShippingMethodButtonAlternate").removeClass("checkout_saveShippingMethodButtonAlternate"),jQuery("#checkout_saveShippingMethodButtonAlternate").addClass("checkout_saveShippingMethodButtonAlternatePickup"),localStorage.newCheckoutMagicFlag1=1,jQuery("#checkout-step-billing").hide(),jQuery("#co-billing-form").hide(),jQuery("#co-shipping-form").hide(),0<jQuery("#shipping-form-container #checkout_select_store_pickup_container").length?console.log("Number of Buttons = "+jQuery("#shipping-form-container #checkout_select_store_pickup_container").length):(console.log("Number of Buttons = 0"),jQuery("#checkout_select_store_pickup_container").appendTo("#shipping-form-container")),jQuery("#co-shipping-method-form").hide(),jQuery("#checkout-step-shipping").show(),jQuery("#shipping-form-container").show(),jQuery("#checkout_select_store_pickup").removeClass("hidden"),jQuery("#checkout_select_store_pickup_container").show(),localStorage.newCheckoutProcessCurrentStep="opc-shipping",localStorage.newCheckoutShippingMethod="pickup",localStorage.newCheckoutPickupLocation=localStorage.newCheckoutSelectedPickupLocation):(console.log("gotoSection = payment (1)"),localStorage.newCheckoutProcessCurrentStep="opc-payment",this.gotoSection("payment"),jQuery("#checkout-step-billing").hide(),jQuery("#co-billing-form").hide()):"prospect-light"==localStorage.newCheckoutProspectRole&&"opc-shipping_method"==localStorage.newCheckoutProcessCurrentStep?(console.log("Alternative route to pickup selection (light prospect 222)"),jQuery("#checkout_saveShippingMethodButtonAlternate").removeClass("checkout_saveShippingMethodButtonAlternate"),jQuery("#checkout_saveShippingMethodButtonAlternate").addClass("checkout_saveShippingMethodButtonAlternatePickup"),localStorage.newCheckoutMagicFlag1=1,jQuery("#checkout-step-billing").hide(),jQuery("#co-billing-form").hide(),jQuery("#co-shipping-form").hide(),jQuery("#checkout_select_store_pickup_container").appendTo("#shipping-form-container"),jQuery("#co-shipping-method-form").hide(),jQuery("#checkout-step-shipping").show(),jQuery("#shipping-form-container").show(),jQuery("#checkout_select_store_pickup").removeClass("hidden"),jQuery("#checkout_select_store_pickup_container").show(),localStorage.newCheckoutProcessCurrentStep="opc-shipping",localStorage.newCheckoutShippingMethod="pickup",localStorage.newCheckoutPickupLocation=localStorage.newCheckoutSelectedPickupLocation):"guest"==localStorage.newCheckoutProcessCurrentRole&&1!=localStorage.newCheckoutMagicFlag2?(console.log("Alternative route to pickup selection (guest)"),jQuery("#checkout_saveShippingMethodButtonAlternate").removeClass("checkout_saveShippingMethodButtonAlternate"),jQuery("#checkout_saveShippingMethodButtonAlternate").addClass("checkout_saveShippingMethodButtonAlternatePickup"),localStorage.newCheckoutMagicFlag1=1,jQuery("#checkout-step-billing").hide(),jQuery("#co-billing-form").hide(),jQuery("#co-shipping-form").hide(),jQuery("#checkout_select_store_pickup_container").appendTo("#shipping-form-container"),jQuery("#co-shipping-method-form").hide(),jQuery("#checkout-step-shipping").show(),jQuery("#shipping-form-container").show(),jQuery("#checkout_select_store_pickup").removeClass("hidden"),jQuery("#checkout_select_store_pickup_container").show(),localStorage.newCheckoutProcessCurrentStep="opc-shipping",localStorage.newCheckoutShippingMethod="pickup",localStorage.newCheckoutPickupLocation=localStorage.newCheckoutSelectedPickupLocation):(console.log("Normal Case: gotoSection = "+e.goto_section),"payment"==e.goto_section&&(localStorage.newCheckoutProcessCurrentStep="opc-payment"),this.gotoSection(e.goto_section)),!0):!!e.redirect&&(location.href=e.redirect,!0)}};var Billing=Class.create();Billing.prototype={initialize:function(e,t,o){this.form=e,$(this.form)&&$(this.form).observe("submit",function(e){this.save(),Event.stop(e)}.bind(this)),this.addressUrl=t,this.saveUrl=o,this.onAddressLoad=this.fillForm.bindAsEventListener(this),this.onSave=this.nextStep.bindAsEventListener(this),this.onComplete=this.resetLoadWaiting.bindAsEventListener(this)},setAddress:function(e){e?request=new Ajax.Request(this.addressUrl+e,{method:"get",onSuccess:this.onAddressLoad,onFailure:checkout.ajaxFailure.bind(checkout)}):this.fillForm(!1)},newAddress:function(e){e?(this.resetSelectedAddress(),Element.show("billing-new-address-form")):Element.hide("billing-new-address-form")},resetSelectedAddress:function(){var e=$("billing-address-select");e&&(e.value="")},fillForm:function(transport){var elementValues={};if(transport&&transport.responseText)try{elementValues=eval("("+transport.responseText+")")}catch(e){elementValues={}}else this.resetSelectedAddress();for(var elemIndex in arrElements=Form.getElements(this.form),arrElements)if(arrElements[elemIndex].id){var fieldName=arrElements[elemIndex].id.replace(/^billing:/,"");arrElements[elemIndex].value=elementValues[fieldName]?elementValues[fieldName]:"","country_id"==fieldName&&billingForm&&billingForm.elementChildLoad(arrElements[elemIndex])}},save:function(){if(0==checkout.loadWaiting){var e=new Validation(this.form);if(console.log("opcheckout.js -> billing.save() -- step #1"),e.validate()){checkout.setLoadWaiting("billing");var t="normal";"none"==localStorage.newCheckoutProcessSpecialAction&&"prospect-full"==localStorage.newCheckoutProspectRole&&"processCheckoutAsLoggedInUser"==localStorage.newCheckoutRunningProcess&&(t="oldFullProspect"),"full-register-prospect-application"==localStorage.newCheckoutProcessSpecialAction&&"prospect-light"==localStorage.newCheckoutProspectRole&&"processCheckoutAsLoggedInUser"==localStorage.newCheckoutRunningProcess&&(t="oldLightProspect"),"full-register-prospect-application"==localStorage.newCheckoutProcessSpecialAction&&"prospect-user"==localStorage.newCheckoutProcessCurrentRole&&"processCheckoutAsNonLoggedInUser"==localStorage.newCheckoutRunningProcess&&(t="newProspect"),"none"==localStorage.newCheckoutProcessSpecialAction&&"guest"==localStorage.newCheckoutProcessCurrentRole&&"processCheckoutAsNonLoggedInUser"==localStorage.newCheckoutRunningProcess&&(t="guest");var o;o="billing%5Bcustomer_type%5D="+t+"&",console.log("opcheckout.js -> billing.save() -- step #2");new Ajax.Request(this.saveUrl,{method:"post",onComplete:this.onComplete,onSuccess:this.onSave,onFailure:checkout.ajaxFailure.bind(checkout),parameters:o+Form.serialize(this.form)})}else jQuery("#checkout_saveBillingButtonContinue").show(),console.log("opcheckout.js -> billing.save() -- validator.validate() returned false !!!")}},resetLoadWaiting:function(e){checkout.setLoadWaiting(!1)},nextStep:function(transport){if(transport&&transport.responseText)try{response=eval("("+transport.responseText+")")}catch(e){response={}}if(response.error)return"string"==typeof response.message?alert(response.message):(window.billingRegionUpdater&&billingRegionUpdater.update(),alert(response.message.join("\n"))),!1;jQuery(".usebilling_address_for_shipping_no").is(":checked")&&(localStorage.newCheckoutProcessCurrentStep="opc-shipping"),jQuery(".usebilling_address_for_shipping_yes").is(":checked")&&(localStorage.newCheckoutProcessCurrentStep="opc-shipping_method"),checkout.setStepResponse(response),payment.initWhatIsCvvListeners()}};var Shipping=Class.create();Shipping.prototype={initialize:function(e,t,o,s){this.form=e,$(this.form)&&$(this.form).observe("submit",function(e){this.save(),Event.stop(e)}.bind(this)),this.addressUrl=t,this.saveUrl=o,this.methodsUrl=s,this.onAddressLoad=this.fillForm.bindAsEventListener(this),this.onSave=this.nextStep.bindAsEventListener(this),this.onComplete=this.resetLoadWaiting.bindAsEventListener(this)},setAddress:function(e){e?request=new Ajax.Request(this.addressUrl+e,{method:"get",onSuccess:this.onAddressLoad,onFailure:checkout.ajaxFailure.bind(checkout)}):this.fillForm(!1)},newAddress:function(e){e?(this.resetSelectedAddress(),Element.show("shipping-new-address-form")):Element.hide("shipping-new-address-form")},resetSelectedAddress:function(){var e=$("shipping-address-select");e&&(e.value="")},fillForm:function(transport){var elementValues={};if(transport&&transport.responseText)try{elementValues=eval("("+transport.responseText+")")}catch(e){elementValues={}}else this.resetSelectedAddress();for(var elemIndex in arrElements=Form.getElements(this.form),arrElements)if(arrElements[elemIndex].id){var fieldName=arrElements[elemIndex].id.replace(/^shipping:/,"");arrElements[elemIndex].value=elementValues[fieldName]?elementValues[fieldName]:"","country_id"==fieldName&&shippingForm&&shippingForm.elementChildLoad(arrElements[elemIndex])}},syncWithBilling:function(){if($("billing-address-select")&&this.newAddress(!$("billing-address-select").value),$("shipping:same_as_billing").checked=!0,$("billing-address-select")&&$("billing-address-select").value)$("shipping-address-select").value=$("billing-address-select").value;else{for(var e in arrElements=Form.getElements(this.form),arrElements)if(arrElements[e].id){var t=$(arrElements[e].id.replace(/^shipping:/,"billing:"));t&&(arrElements[e].value=t.value)}shippingRegionUpdater.update(),$("shipping:region_id").value=$("billing:region_id").value,$("shipping:region").value=$("billing:region").value}},setRegionValue:function(){$("shipping:region").value=$("billing:region").value},save:function(){if(0==checkout.loadWaiting&&new Validation(this.form).validate()){var e="normal",t="",o="",s="",r="",c="no",i="";switch("none"==localStorage.newCheckoutProcessSpecialAction&&"prospect-full"==localStorage.newCheckoutProspectRole&&"processCheckoutAsLoggedInUser"==localStorage.newCheckoutRunningProcess?e="oldFullProspect":"full-register-prospect-application"==localStorage.newCheckoutProcessSpecialAction&&"prospect-light"==localStorage.newCheckoutProspectRole&&"processCheckoutAsLoggedInUser"==localStorage.newCheckoutRunningProcess?e="oldLightProspect":"full-register-prospect-application"==localStorage.newCheckoutProcessSpecialAction&&"prospect-user"==localStorage.newCheckoutProcessCurrentRole&&"processCheckoutAsNonLoggedInUser"==localStorage.newCheckoutRunningProcess?e="newProspect":"none"==localStorage.newCheckoutProcessSpecialAction&&"guest"==localStorage.newCheckoutProcessCurrentRole&&"processCheckoutAsNonLoggedInUser"==localStorage.newCheckoutRunningProcess&&(e="guest"),localStorage.newCheckoutShippingMethod){case"pickup":t="pickup",o=localStorage.newCheckoutPickupLocation;break;case"container":t="container",r=localStorage.newCheckoutWwsIdContainer;break;case"inpost":t="inpost",s=localStorage.newCheckoutWwsIdInpost;default:t="shipping",o="none"}jQuery("#shipping-address-select")&&""==jQuery("#shipping-address-select").val()||void 0===jQuery("#shipping-address-select").val()?c="yes":i="shipping%5Bold_address_id%5D="+jQuery("#shipping-address-select").val()+"&";var a;a=i+"shipping%5Bnew_address%5D="+c+"&shipping%5Bcustomer_type%5D="+e+"&shipping%5Bshipping_method%5D="+t+"&shipping%5Bpickup_location%5D="+o+"&container_id="+r+"&inpost_id="+s+"&",checkout.setLoadWaiting("shipping");new Ajax.Request(this.saveUrl,{method:"post",onComplete:this.onComplete,onSuccess:this.onSave,onFailure:checkout.ajaxFailure.bind(checkout),parameters:a+Form.serialize(this.form)})}},resetLoadWaiting:function(e){checkout.setLoadWaiting(!1)},nextStep:function(transport){if(transport&&transport.responseText)try{response=eval("("+transport.responseText+")")}catch(e){response={}}if(response.error)return"string"==typeof response.message?alert(response.message):(window.shippingRegionUpdater&&shippingRegionUpdater.update(),alert(response.message.join("\n"))),!1;checkout.setStepResponse(response)}};var ShippingMethod=Class.create(),shippingMethodCheck=localStorage.shippingMethodCheck;ShippingMethod.prototype={initialize:function(e,t){this.form=e,$(this.form)&&$(this.form).observe("submit",function(e){this.save(),Event.stop(e)}.bind(this)),this.saveUrl=t,this.validator=new Validation(this.form),this.onSave=this.nextStep.bindAsEventListener(this),this.onComplete=this.resetLoadWaiting.bindAsEventListener(this)},validate:function(){var e=document.getElementsByName("shipping_method[type]");if(0==e.length)return alert(Translator.translate("Your order can not be completed at this time as there is no shipping methods available for it. Please make neccessary changes in your shipping address.")),!1;if(!this.validator.validate())return!1;for(var t=0;t<e.length;t++)if(e[t].checked)return!0;return"delivery"==shippingMethodCheck||"pickup"==shippingMethodCheck||"container"==shippingMethodCheck||"inpost"==shippingMethodCheck?(console.log("Opcheckout -> shippingMethodCheck if ture= "+shippingMethodCheck),!0):(console.log("Opcheckout -> shippingMethodCheck if false= "+shippingMethodCheck),jQuery("#shipping-method-warning").text(Translator.translate("Please specify shipping method.")),jQuery("#shipping-method-warning").show(),jQuery("#shipping-method-warning").fadeOut(5e3),localStorage.newCheckoutProcessCurrentStep="opc-shipping_method",console.log("Hier ist der fehler!"),jQuery("#checkout_saveShippingMethodButtonContinue").show(),!1)},save:function(){if(console.log("opcheckout.js -> shippingMethod.save() -- step #1"),0==checkout.loadWaiting){if("guest"==localStorage.newCheckoutProcessCurrentRole&&1==localStorage.newCheckoutMagicFlag1?(console.log("opcheckout.js -> role = guest + magicFlag = 1"),!0):(console.log("opcheckout.js -> must be validated to shippingMethod"),this.validate())){checkout.setLoadWaiting("shipping-method"),"undefined"!=typeof ga&&ga&&(ga("ec:setAction","checkout_option",{step:3,option:jQuery("label[for='"+jQuery('input[name="shipping_method[type]"]:checked',"#"+this.form).attr("id")+"']").text()}),ga("send","event","Checkout","Option"));var e="normal";"none"==localStorage.newCheckoutProcessSpecialAction&&"prospect-full"==localStorage.newCheckoutProspectRole&&"processCheckoutAsLoggedInUser"==localStorage.newCheckoutRunningProcess&&(e="oldFullProspect"),"full-register-prospect-application"==localStorage.newCheckoutProcessSpecialAction&&"prospect-light"==localStorage.newCheckoutProspectRole&&"processCheckoutAsLoggedInUser"==localStorage.newCheckoutRunningProcess&&(e="oldLightProspect"),"full-register-prospect-application"==localStorage.newCheckoutProcessSpecialAction&&"prospect-user"==localStorage.newCheckoutProcessCurrentRole&&"processCheckoutAsNonLoggedInUser"==localStorage.newCheckoutRunningProcess&&(e="newProspect"),"none"==localStorage.newCheckoutProcessSpecialAction&&"guest"==localStorage.newCheckoutProcessCurrentRole&&"processCheckoutAsNonLoggedInUser"==localStorage.newCheckoutRunningProcess&&(e="guest");var t;t="shipping_method%5Bcustomer_type%5D="+e+"&";new Ajax.Request(this.saveUrl,{method:"post",onComplete:this.onComplete,onSuccess:this.onSave,onFailure:checkout.ajaxFailure.bind(checkout),parameters:t+Form.serialize(this.form)})}}},resetLoadWaiting:function(e){checkout.setLoadWaiting(!1)},nextStep:function(transport){if(transport&&transport.responseText)try{response=eval("("+transport.responseText+")")}catch(e){response={}}return response.error?(alert(response.message),!1):(response.update_section&&($("checkout-"+response.update_section.name+"-load").update(response.update_section.html),response.update_section.html.evalScripts()),payment.initWhatIsCvvListeners(),response.goto_section?(checkout.gotoSection(response.goto_section),void checkout.reloadProgressBlock()):(response.payment_methods_html&&$("checkout-payment-method-load").update(response.payment_methods_html),void checkout.setShippingMethod()))}};var Payment=Class.create();Payment.prototype={beforeInitFunc:$H({}),afterInitFunc:$H({}),beforeValidateFunc:$H({}),afterValidateFunc:$H({}),initialize:function(e,t){this.form=e,this.saveUrl=t,this.onSave=this.nextStep.bindAsEventListener(this),this.onComplete=this.resetLoadWaiting.bindAsEventListener(this)},addBeforeInitFunction:function(e,t){this.beforeInitFunc.set(e,t)},beforeInit:function(){this.beforeInitFunc.each(function(e){e.value()})},init:function(){this.beforeInit();var e=Form.getElements(this.form);$(this.form)&&$(this.form).observe("submit",function(e){this.save(),Event.stop(e)}.bind(this));for(var t=null,o=0;o<e.length;o++)"payment[method]"==e[o].name||"form_key"==e[o].name?e[o].checked&&(t=e[o].value):"payment[schrack_custom_order_number]"!=e[o].name&&(e[o].disabled=!0),e[o].setAttribute("autocomplete","off");t&&this.switchMethod(t),this.afterInit()},addAfterInitFunction:function(e,t){this.afterInitFunc.set(e,t)},afterInit:function(){this.afterInitFunc.each(function(e){e.value()})},switchMethod:function(e){if(this.currentMethod&&$("payment_form_"+this.currentMethod)){(s=$("payment_form_"+this.currentMethod)).style.display="none";for(var t=s.select("input","select","textarea"),o=0;o<t.length;o++)t[o].disabled=!0}if($("payment_form_"+e)){var s;(s=$("payment_form_"+e)).style.display="";for(t=s.select("input","select","textarea"),o=0;o<t.length;o++)t[o].disabled=!1}this.currentMethod=e,jQuery(document).ready(function(){var e=jQuery("payment-schrack-custom-order-number");e&&(e.disabled=!1)})},addBeforeValidateFunction:function(e,t){this.beforeValidateFunc.set(e,t)},beforeValidate:function(){var t=!0,o=!1;return this.beforeValidateFunc.each(function(e){o=!0,0==e.value()&&(t=!1)}.bind(this)),o||(t=!1),t},validate:function(){var e=this.beforeValidate();if(e)return!0;var t=document.getElementsByName("payment[method]");if(0==t.length)return alert(Translator.translate("Your order cannot be completed at this time as there is no payment methods available for it.")),!1;for(var o=0;o<t.length;o++)if(t[o].checked)return!0;return!!(e=this.afterValidate())||(console.log(Translator.translate("Please specify payment method.")),!1)},addAfterValidateFunction:function(e,t){this.afterValidateFunc.set(e,t)},afterValidate:function(){var t=!0,o=!1;return this.afterValidateFunc.each(function(e){o=!0,0==e.value()&&(t=!1)}.bind(this)),o||(t=!1),t},save:function(){if(console.log("skin/frontend/schrack/default/schrackdesign/Public/Javascript/opcheckout.js  -> payment.save()"),0==checkout.loadWaiting){var e=new Validation(this.form);if(this.validate()&&e.validate()){checkout.setLoadWaiting("payment"),"undefined"!=typeof ga&&ga&&(ga("ec:setAction","checkout_option",{step:4,option:jQuery("label[for='"+jQuery("input[name=payment\\[method\\]]:checked","#"+this.form).attr("id")+"']").text()}),ga("send","event","Checkout","Option"));var t,o="payment%5Bcustomer_type%5D=normal",s="",r="",c="",i="";""!=localStorage.newCheckoutLocalVAT&&(r="payment%5Blocal_vat%5D="+localStorage.newCheckoutLocalVAT+"&"),""!=localStorage.newCheckoutProcessCompanyRegistrationNumber&&(c="payment%5Breg_number%5D="+localStorage.newCheckoutProcessCompanyRegistrationNumber+"&"),""!=localStorage.newCheckoutProcessVATIdentificationNumber&&(s="payment%5Bvat_number%5D="+localStorage.newCheckoutProcessVATIdentificationNumber+"&"),""!=localStorage.newCheckoutProcessStreet1&&(i="payment%5Bstreet1%5D="+localStorage.newCheckoutProcessStreet1+"&"),"none"==localStorage.newCheckoutProcessSpecialAction&&"prospect-full"==localStorage.newCheckoutProspectRole&&"processCheckoutAsLoggedInUser"==localStorage.newCheckoutRunningProcess&&(o="payment%5Bcustomer_type%5D=oldFullProspect"),"full-register-prospect-application"==localStorage.newCheckoutProcessSpecialAction&&"prospect-light"==localStorage.newCheckoutProspectRole&&"processCheckoutAsLoggedInUser"==localStorage.newCheckoutRunningProcess&&(o="payment%5Bcustomer_type%5D=oldLightProspect"),"full-register-prospect-application"==localStorage.newCheckoutProcessSpecialAction&&"prospect-user"==localStorage.newCheckoutProcessCurrentRole&&"processCheckoutAsNonLoggedInUser"==localStorage.newCheckoutRunningProcess&&(o="payment%5Bcustomer_type%5D=newProspect"),"none"==localStorage.newCheckoutProcessSpecialAction&&"guest"==localStorage.newCheckoutProcessCurrentRole&&"processCheckoutAsNonLoggedInUser"==localStorage.newCheckoutRunningProcess&&(o="payment%5Bcustomer_type%5D=guest"),t=r+c+s+i+o;new Ajax.Request(this.saveUrl,{method:"post",onComplete:this.onComplete,onSuccess:this.onSave,onFailure:checkout.ajaxFailure.bind(checkout),parameters:t+"&"+Form.serialize(this.form)})}}},resetLoadWaiting:function(){checkout.setLoadWaiting(!1)},nextStep:function(transport){if(transport&&transport.responseText)try{response=eval("("+transport.responseText+")")}catch(e){response={}}if(response.error){if(response.fields){for(var fields=response.fields.split(","),i=0;i<fields.length;i++){var field=null;(field=$(fields[i]))&&Validation.ajaxError(field,response.error)}return}alert(response.error)}else localStorage.newCheckoutProcessCurrentStep="opc-review",checkout.setStepResponse(response)},initWhatIsCvvListeners:function(){$$(".cvv-what-is-this").each(function(e){Event.observe(e,"click",toggleToolTip)})}};var Review=Class.create();Review.prototype={initialize:function(e,t,o){console.log("saveUrl = "+e),this.saveUrl=e,this.successUrl=t,this.agreementsForm=o,this.onSave=this.nextStep.bindAsEventListener(this),this.onComplete=this.resetLoadWaiting.bindAsEventListener(this)},save:function(){if(0==checkout.loadWaiting){checkout.setLoadWaiting("review"),"undefined"!=typeof ga&&ga&&(ga("ec:setAction","checkout_option",{step:5}),ga("send","event","Forms","submit","checkout_done"));var e=[];"undefined"!=typeof payment&&(e=Form.serialize(payment.form)),this.agreementsForm&&(e+="&"+Form.serialize(this.agreementsForm));var t="normal";"none"==localStorage.newCheckoutProcessSpecialAction&&"prospect-full"==localStorage.newCheckoutProspectRole&&"processCheckoutAsLoggedInUser"==localStorage.newCheckoutRunningProcess&&(t="oldFullProspect"),"full-register-prospect-application"==localStorage.newCheckoutProcessSpecialAction&&"prospect-light"==localStorage.newCheckoutProspectRole&&"processCheckoutAsLoggedInUser"==localStorage.newCheckoutRunningProcess&&(t="oldLightProspect"),"full-register-prospect-application"==localStorage.newCheckoutProcessSpecialAction&&"prospect-user"==localStorage.newCheckoutProcessCurrentRole&&"processCheckoutAsNonLoggedInUser"==localStorage.newCheckoutRunningProcess&&(t="newProspect"),"none"==localStorage.newCheckoutProcessSpecialAction&&"guest"==localStorage.newCheckoutProcessCurrentRole&&"processCheckoutAsNonLoggedInUser"==localStorage.newCheckoutRunningProcess&&(t="guest");var o,s="",r="",c="",i="",a="",n="",l="",p="",u="",h="",_="",g="",d="",k="",m="",C="",v="",y="",S="",f="",w="";""!=localStorage.newCheckoutProcessEmail&&(r="order%5Bemail%5D="+localStorage.newCheckoutProcessEmail+"&"),""!=localStorage.newCheckoutProcessPassword&&(c="order%5Bpassword%5D="+localStorage.newCheckoutProcessPassword+"&"),""!=localStorage.newCheckoutProcessGender&&(s="order%5Bgender%5D="+localStorage.newCheckoutProcessGender+"&"),""!=localStorage.newCheckoutProcessVATIdentificationNumber&&(i="order%5Bvat_number%5D="+localStorage.newCheckoutProcessVATIdentificationNumber+"&"),""!=localStorage.newCheckoutProcessCompanyRegistrationNumber&&(a="order%5Breg_number%5D="+localStorage.newCheckoutProcessCompanyRegistrationNumber+"&"),""!=localStorage.newCheckoutProcessPersonFirstname&&(l="order%5Bfirstname%5D="+localStorage.newCheckoutProcessPersonFirstname+"&"),""!=localStorage.newCheckoutProcessPersonLastname&&(n="order%5Blastname%5D="+localStorage.newCheckoutProcessPersonLastname+"&"),""!=localStorage.newCheckoutProcessName1&&(p="order%5Bname1%5D="+localStorage.newCheckoutProcessName1+"&"),""!=localStorage.newCheckoutProcessName2&&(u="order%5Bname2%5D="+localStorage.newCheckoutProcessName2+"&"),""!=localStorage.newCheckoutProcessName3&&(h="order%5Bname3%5D="+localStorage.newCheckoutProcessName3+"&"),""!=localStorage.newCheckoutProcessStreet1&&(_="order%5Bstreet1%5D="+localStorage.newCheckoutProcessStreet1+"&"),""!=localStorage.newCheckoutProcessPostcode&&(g="order%5Bpostcode%5D="+localStorage.newCheckoutProcessPostcode+"&"),""!=localStorage.newCheckoutProcessCity&&(d="order%5Bcity%5D="+localStorage.newCheckoutProcessCity+"&"),""!=localStorage.newCheckoutProcessRegionId&&(k="order%5Bregion_id%5D="+localStorage.newCheckoutProcessRegionId+"&"),""!=localStorage.newCheckoutProcessCountryId&&(m="order%5Bcountry_id%5D="+localStorage.newCheckoutProcessCountryId+"&"),""!=localStorage.newCheckoutHomepage&&(C="order%5Bhomepage%5D="+localStorage.newCheckoutHomepage+"&"),""!=localStorage.newCheckoutProcessTelephone&&(v="order%5Btelephone%5D="+encodeURIComponent(localStorage.newCheckoutProcessTelephone)+"&"),""!=localStorage.newCheckoutProcessTelephoneCompany&&(S="order%5Btelephone_company%5D="+encodeURIComponent(localStorage.newCheckoutProcessTelephoneCompany)+"&"),""!=localStorage.newCheckoutProcessFax&&(y="order%5Bfax%5D="+encodeURIComponent(localStorage.newCheckoutProcessFax)+"&"),""!=localStorage.newCheckoutNewsletter&&(f="order%5Bnewsletter%5D="+localStorage.newCheckoutNewsletter+"&"),""!=localStorage.newCheckoutLocalVAT&&(w="order%5Blocal_vat%5D="+localStorage.newCheckoutLocalVAT+"&"),o=i+a+("order%5Bcustomer_type%5D="+t+"&")+s+r+c+l+n+p+u+h+_+g+d+k+m+C+v+S+y+f+w,e.save=!0;new Ajax.Request(this.saveUrl,{method:"post",parameters:o+e,onComplete:this.onComplete,onSuccess:this.onSave,onFailure:checkout.ajaxFailure.bind(checkout)})}},resetLoadWaiting:function(e){checkout.setLoadWaiting(!1,this.isSuccess)},nextStep:function(transport){if(transport&&transport.responseText){try{response=eval("("+transport.responseText+")")}catch(e){response={}}if(response.redirect)return void(location.href=response.redirect);if(response.success)this.isSuccess=!0,window.location=this.successUrl;else{var msg=response.error_messages;"object"==typeof msg&&(msg=msg.join("\n")),console.log(msg),jQuery("#review-warning").text(msg),jQuery("#review-warning").show(),jQuery("#review-warning").fadeOut(5e3)}response.update_section&&($("checkout-"+response.update_section.name+"-load").update(response.update_section.html),response.update_section.html.evalScripts()),response.goto_section&&(checkout.gotoSection(response.goto_section),checkout.reloadProgressBlock())}},isSuccess:!1};var Address=Class.create();Address.prototype={beforeInitFunc:$H({}),afterInitFunc:$H({}),beforeValidateFunc:$H({}),afterValidateFunc:$H({}),initialize:function(e,t){this.form=e,this.saveUrl=t,this.onSave=this.nextStep.bindAsEventListener(this),this.onComplete=this.resetLoadWaiting.bindAsEventListener(this)},addBeforeInitFunction:function(e,t){this.beforeInitFunc.set(e,t)},beforeInit:function(){this.beforeInitFunc.each(function(e){e.value()})},init:function(){this.beforeInit();Form.getElements(this.form);$(this.form)&&$(this.form).observe("submit",function(e){this.save(),Event.stop(e)}.bind(this)),this.afterInit()},addAfterInitFunction:function(e,t){this.afterInitFunc.set(e,t)},afterInit:function(){this.afterInitFunc.each(function(e){e.value()})},addBeforeValidateFunction:function(e,t){this.beforeValidateFunc.set(e,t)},beforeValidate:function(){var t=!0,o=!1;return this.beforeValidateFunc.each(function(e){o=!0,0==e.value()&&(t=!1)}.bind(this)),o||(t=!1),t},validate:function(){this.beforeValidate();return!0},addAfterValidateFunction:function(e,t){this.afterValidateFunc.set(e,t)},afterValidate:function(){var t=!0,o=!1;return this.afterValidateFunc.each(function(e){o=!0,0==e.value()&&(t=!1)}.bind(this)),o||(t=!1),t},save:function(){if(0==checkout.loadWaiting){var e=new Validation(this.form);if(this.validate()&&e.validate()){checkout.setLoadWaiting("address");new Ajax.Request(this.saveUrl,{method:"post",onComplete:this.onComplete,onSuccess:this.onSave,onFailure:checkout.ajaxFailure.bind(checkout),parameters:Form.serialize(this.form)})}}},resetLoadWaiting:function(){checkout.setLoadWaiting(!1)},nextStep:function(transport){if(transport&&transport.responseText)try{response=eval("("+transport.responseText+")")}catch(e){response={}}if(response.error){if(response.fields){for(var fields=response.fields.split(","),i=0;i<fields.length;i++){var field=null;(field=$(fields[i]))&&Validation.ajaxError(field,response.error)}return}alert("Error "+response.error_messages)}else checkout.setStepResponse(response)},initWhatIsCvvListeners:function(){$$(".cvv-what-is-this").each(function(e){Event.observe(e,"click",toggleToolTip)})}};
//# sourceMappingURL=packedOpcheckout.js.map